#
# The gitlab CI script for luSolve
#

stages:
  - setup
  - build
  - test
  - benchmark

setup_job:
  stage: setup
  script:
    - stack setup
  tags:
    - stack-runner
  when: manual

build_job:
  stage: build
  script:
    - stack build --system-ghc --no-install-ghc --pedantic
  tags:
    - stack-runner

test_job:
  stage: test
  script:
    - stack test --system-ghc --no-install-ghc --pedantic --coverage
  tags:
    - stack-runner

benchmark_job:
  stage: benchmark
  script:
    - env LANG=en_US.UTF-8 MM_CHARSET=UTF-8 stack bench --system-ghc --no-install-ghc --benchmark-arguments '--time-limit 30'
  tags:
    - stack-runner
